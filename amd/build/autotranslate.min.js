define("filter_autotranslate/autotranslate",["core/ajax","core/notification"],(function(Ajax,Notification){function startTask(methodname,params){var autotranslateButton=document.getElementById("autotranslate-button"),rebuildButton=document.getElementById("rebuild-button");autotranslateButton&&autotranslateButton.setAttribute("disabled","disabled"),rebuildButton&&rebuildButton.setAttribute("disabled","disabled");var progressContainer=document.getElementById("task-progress");progressContainer.style.display="block";var progressBar=progressContainer.querySelector(".progress-bar");progressBar.classList.remove("bg-danger"),progressBar.classList.add("bg-primary"),progressBar.style.width="0%",progressBar.setAttribute("aria-valuenow","0"),progressBar.textContent="0%",Ajax.call([{methodname:methodname,args:params,done:function(response){response.success&&response.taskid?(Notification.addNotification({message:"Task queued successfully. Please wait for completion.",type:"success"}),pollTaskStatus(response.taskid)):(Notification.addNotification({message:response.message||"Failed to queue task.",type:"error"}),resetUI())},fail:function(error){Notification.addNotification({message:"Error queuing task: "+error.message,type:"error"}),resetUI()}}])}function pollTaskStatus(taskid){Ajax.call([{methodname:"filter_autotranslate_task_status",args:{taskid:taskid},done:function(response){var progressBar=document.querySelector("#task-progress .progress-bar");progressBar&&(progressBar.style.width=response.percentage+"%",progressBar.setAttribute("aria-valuenow",response.percentage),progressBar.textContent=response.percentage+"%","failed"===response.status&&(progressBar.classList.remove("bg-primary"),progressBar.classList.add("bg-danger"))),"completed"===response.status?(Notification.addNotification({message:"Task completed successfully. Reloading page...",type:"success"}),setTimeout((function(){location.reload()}),1e3)):"failed"===response.status?(Notification.addNotification({message:"Task failed. Please check logs for details.",type:"error"}),resetUI()):setTimeout((function(){pollTaskStatus(taskid)}),5e3)},fail:function(error){Notification.addNotification({message:"Error checking task status: "+error.message,type:"error"});var progressBar=document.querySelector("#task-progress .progress-bar");progressBar&&(progressBar.classList.remove("bg-primary"),progressBar.classList.add("bg-danger")),resetUI()}}])}function resetUI(){var autotranslateButton=document.getElementById("autotranslate-button"),rebuildButton=document.getElementById("rebuild-button");autotranslateButton&&autotranslateButton.removeAttribute("disabled"),rebuildButton&&rebuildButton.removeAttribute("disabled");var progressContainer=document.getElementById("task-progress");progressContainer.style.display="none";var progressBar=progressContainer.querySelector(".progress-bar");progressBar&&(progressBar.style.width="0%",progressBar.setAttribute("aria-valuenow","0"),progressBar.textContent="0%")}return{init:function(){console.log("Autotranslate JavaScript module loaded and initialized.");var autotranslateButton=document.getElementById("autotranslate-button");autotranslateButton?(console.log("Autotranslate button found:",autotranslateButton),autotranslateButton.addEventListener("click",(function(){console.log("Autotranslate button clicked."),startTask("filter_autotranslate_autotranslate",JSON.parse(autotranslateButton.getAttribute("data-filter-params")))}))):console.log("Autotranslate button not found.");var rebuildButton=document.getElementById("rebuild-button");rebuildButton?(console.log("Rebuild button found:",rebuildButton),rebuildButton.addEventListener("click",(function(){console.log("Rebuild button clicked."),startTask("filter_autotranslate_rebuild_translations",{courseid:JSON.parse(rebuildButton.getAttribute("data-filter-params")).courseid})}))):console.log("Rebuild button not found.")}}}));

//# sourceMappingURL=autotranslate.min.js.map